services:
  flask:
    build: file_service
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - SERVICE_DIRECTORY=/app/static
    ports:
      - "9000:5000"
    volumes:
      - /mnt/ceph/media/factorio/web-tiles:/app/static:ro
      - ./file_service:/app

  tiler:
    build: tiler
    environment:
      - FOO=bar
    volumes:
      - /mnt/ceph/media/factorio/chunk-screenshots:/app/static:ro
      - /mnt/ceph/media/factorio/web-tiles:/app/web-tiles
      - ./tiler:/app
    command: ["python", "app.py", "task"]